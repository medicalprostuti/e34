<!DOCTYPE html>
<html lang="bn">
  <head>
    <script>
      document.addEventListener("contextmenu", (event) =>
        event.preventDefault()
      );
      document.addEventListener("keydown", (event) => {
        if (
          (event.ctrlKey &&
            ["u", "s", "i", "j"].includes(event.key.toLowerCase())) ||
          event.key === "F12"
        ) {
          event.preventDefault();
        }
      });
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Online Exam</title>
    <!-- Chart.js CDN -->

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap");

      body {
        font-family: "Hind Siliguri", sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      .container {
        font-family: "Hind Siliguri", sans-serif;
        width: 100%;
        margin: auto;
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        min-height: 80vh;
      }

      .exam-content {
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      h1 {
        color: #1b0b54;
        text-align: center;
        margin-bottom: 10px;
      }

      #timer {
        font-size: 20px;
        color: #1b0b54;
        margin-bottom: 5px;
        font-weight: normal;
        text-align: center;
      }

      #exam-info {
        font-size: 16px;
        color: black;
        margin-bottom: 20px;
        text-align: center;
      }

      #exam {
        width: 100%;
        min-height: 100px;
      }

      .chart-container {
        width: 200px;
        height: 200px;
        margin: 10px auto;
        background-color: #f9f9f9;
        border-radius: 15px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: none;
        padding: 10px;
      }

      .chart-container.visible {
        display: block;
      }

      .question-container {
        text-align: left;
        margin-bottom: 20px;
        display: block;
      }

      .question-label {
        font-weight: bold;
        color: #1b0b54;
        margin-bottom: 10px;
      }

      .options {
        margin-top: 10px;
      }

      .option {
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        cursor: pointer;
        padding: 5px;
        border-radius: 5px;
        text-transform: uppercase;
      }

      .circle {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 2px solid #1b0b54;
        margin-right: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #1b0b54;
        font-weight: bold;
        font-size: 18px;
      }

      .selected .circle {
        background-color: #1b0b54;
        color: white;
      }

      .correct-text {
        color: green !important;
      }

      .incorrect-text {
        color: #ff0800 !important;
      }

      .unattempted-text {
        color: orange !important;
      }

      #submitBtn {
        font-family: hind siliguri;
        padding: 15px 30px;
        background-color: #1b0b54;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 18px;
        font-weight: bold;
        border-radius: 10px;
        margin-top: 20px;
        width: 200px;
        transition: background-color 0.3s ease;
      }

      #submitBtn:hover {
        background-color: #1b0b54;
      }

      .popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        width: 300px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        text-align: center;
        display: none;
        z-index: 1000;
        transition: transform 0.5s ease, opacity 0.5s ease;
      }

      .popup.slide-out {
        transform: translate(-50%, -100%);
        opacity: 0;
      }

      .popup-header {
        background-color: #1b0b54;
        color: white;
        padding: 10px;
        font-size: 20px;
        font-weight: bold;
        border-radius: 10px 10px 0 0;
      }

      .popup-body {
        padding: 15px;
      }

      .popup-body p {
        margin: 10px 0;
      }

      .confirm-btn {
        font-family: hind siliguri;
        background-color: #34c759;
        color: white;
        padding: 8px 15px;
        border: none;
        cursor: pointer;
        font-size: 14px;
        border-radius: 5px;
        margin: 5px;
      }

      .confirm-btn:hover {
        background-color: #34c759;
      }

      .cancel-btn {
        background-color: #ff3b30;
        color: white;
        padding: 8px 15px;
        border: none;
        cursor: pointer;
        font-size: 14px;
        border-radius: 5px;
        margin: 5px;
      }

      .cancel-btn:hover {
        background-color: #e02b21;
      }

      .explanation-dropdown {
        display: none;
        margin-top: 10px;
      }

      .explanation-dropdown.visible {
        display: block;
      }

      .explanation-btn {
        background-color: #1b0b54;
        color: white;
        padding: 8px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-family: "Hind Siliguri", sans-serif;
        width: 40%;
        text-align: left;
        position: relative;
      }

      .explanation-btn:hover {
        background-color: #1b0b54;
      }

      .explanation-btn::after {
        content: "▼";
        position: absolute;
        right: 10px;
        font-size: 12px;
      }

      .explanation-btn.active::after {
        content: "▲";
      }

      .explanation-content {
        display: none;
        padding: 15px;
        background-color: #f9f9f9;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 14px;
        color: #000000;
        text-align: left;
        max-height: 450px;
        overflow-y: auto;
        margin-top: 5px;
      }

      .explanation-content.visible {
        display: block;
      }

      .explanation-content p {
        margin: 0 0 10px 0;
      }

      .explanation-content ul {
        margin: 0;
        padding-left: 20px;
      }

      .explanation-content li {
        margin-bottom: 5px;
      }

      .explanation-content strong {
        color: #1b0b54;
      }

      .explanation-label {
        font-weight: bold;
        color: #1b0b54;
        margin-bottom: 10px;
        display: block;
      }

      .locked .option {
        pointer-events: none;
        cursor: default;
      }

      .locked .option.selected {
        pointer-events: none;
        cursor: default;
      }
    </style>
  </head>

  <body>
    <div class="container" id="examContainer">
      <div class="exam-content">
        <h1>ইংরেজী অনুশীলন</h1>
        <div id="timer"></div>
        <div id="exam-info"></div>
        <div class="chart-container">
          <canvas id="scoreChart"></canvas>
        </div>
        <div id="exam">
          <!-- Questions will be generated dynamically -->
        </div>
        <button id="submitBtn">সাবমিট</button>
      </div>
    </div>

    <div class="popup" id="scorePopup">
      <div class="popup-header">তোমার স্কোর</div>
      <div class="popup-body">
        <p><strong>মোট প্রশ্ন:</strong> <span id="totalQuestions"></span></p>
        <p>
          <strong>উত্তর দিয়েছো:</strong>
          <span style="color: #000000" id="answered"></span>
        </p>
        <p>
          <strong>সঠিক উত্তর:</strong>
          <span style="color: #0ab853" id="correctAnswers"></span>
        </p>
        <p>
          <strong>ভুল উত্তর:</strong>
          <span style="color: #f81010" id="wrongAnswers"></span>
        </p>
        <p>
          <strong>অনুত্তরিত:</strong>
          <span style="color: #ffc801" id="unanswered"></span>
        </p>
        <p><strong>তোমার চূড়ান্ত স্কোর:</strong></p>
        <h2 style="color: #1b0b54"><span id="finalScore"></span></h2>
        <form id="scoreForm" action="https://formspree.io/f/xpby" method="POST">
          <input type="hidden" name="userID" id="formUserID" />
          <input type="hidden" name="finalScore" id="formFinalScore" />
          <input type="hidden" name="correctAnswers" id="formCorrectAnswers" />
          <input type="hidden" name="wrongAnswers" id="formWrongAnswers" />
          <input type="hidden" name="unanswered" id="formUnanswered" />
          <button
            type="submit"
            class="confirm-btn"
            style="background-color: #1b0b54"
          >
            <b>ওকে</b>
          </button>
        </form>
      </div>
    </div>

    <div class="popup" id="confirmPopup">
      <div class="popup-header">কনফার্ম করো</div>
      <div class="popup-body">
        <p>
          ভালো করে দেখে নাও! <br />
          পরীক্ষা শেষ করতে চাও তো?
        </p>
        <button class="confirm-btn" onclick="confirmSubmit()">
          <b>হ্যাঁ</b>
        </button>
        <button class="cancel-btn" onclick="cancelSubmit()"><b>না</b></button>
      </div>
    </div>

    <script>
      let chartInstance = null;

      document.addEventListener("DOMContentLoaded", function () {
        console.log("DOM fully loaded and parsed");
        const examContainer = document.getElementById("examContainer");
        if (!examContainer) {
          console.error("Exam container not found!");
          return;
        }
        try {
          sessionStorage.setItem("isLoggedIn", "true");
          sessionStorage.setItem("userID", "anonymous");
          console.log(
            "Session storage set: isLoggedIn = true, userID = anonymous"
          );
        } catch (e) {
          console.error("Session storage error:", e);
        }
        examContainer.style.display = "block";
        console.log("Exam container displayed");
        startTimer();
        generateQuestions();

        window.addEventListener("beforeunload", function (event) {
          if (
            examContainer.style.display === "block" &&
            sessionStorage.getItem("isLoggedIn") === "true"
          ) {
            autoSubmitScore();
          }
        });
      });

      const questions = [
        {
          id: 1,
          question: "It is high time we _ the project.",
          options: {
            a: "start",
            b: "started",
            c: "starting",
            d: "start up",
          },
          correct: "b",
          explanation:
            "<p>When the phrase \"It is high time\" or \"It is time\" is used, the verb that follows in the clause should be in the Past Simple Tense, even though it refers to something that should happen now or in the near future. This structure expresses urgency or a strong suggestion that something should have been done already or needs to be done immediately.</p><ul><li>Option (a) 'start' is in the present tense.</li><li>Option (c) 'starting' is a present participle, requiring an auxiliary verb.</li><li>Option (d) 'start up' is a phrasal verb in the present tense.</li><li>Option (b) 'started' is in the Past Simple Tense, which correctly follows the grammatical rule for \"It is high time\".</li></ul><p>Therefore, the correct answer is (b).</p>",
        },
        {
          id: 2,
          question: "I don't mind _ negative feedback if it is true.",
          options: {
            a: "accept",
            b: "accepting",
            c: "to accept",
            d: "of accepting",
          },
          correct: "b",
          explanation:
            "<p>The verb \"mind\" is typically followed by a gerund (the -ing form of a verb). This structure indicates a willingness or unwillingness to do something.</p><ul><li>Option (a) 'accept' is the base form of the verb.</li><li>Option (c) 'to accept' is an infinitive.</li><li>Option (d) 'of accepting' is incorrect as \"mind\" does not usually take the preposition \"of\" before the gerund in this context.</li><li>Option (b) 'accepting' is the gerund form, which correctly follows \"mind\".</li></ul><p>Therefore, the correct answer is (b).</p>",
        },
        {
          id: 3,
          question:
            "They could not help _ leave the car on the road, where it had broken down.",
          options: {
            a: "unless",
            b: "but",
            c: "than",
            d: "instead of",
          },
          correct: "b",
          explanation:
            '<p>The phrase "could not help but" is an idiom meaning "had no choice but to" or "could not avoid". It is followed by the base form of the verb.</p><ul><li>Option (a) \'unless\' is a conjunction meaning "if not".</li><li>Option (c) \'than\' is a conjunction used for comparison.</li><li>Option (d) \'instead of\' is a prepositional phrase meaning "in place of".</li><li>Option (b) \'but\' is used in the idiom "could not help but".</li></ul><p>Therefore, the correct answer is (b).</p>',
        },
        {
          id: 4,
          question: "Would you mind _ a cup of coffee with me?",
          options: {
            a: "drink",
            b: "having to drink",
            c: "having",
            d: "to drink",
          },
          correct: "c",
          explanation:
            "<p>The phrase \"Would you mind\" is followed by a gerund (the -ing form of a verb) when asking for permission or making a polite request. In this context, \"having\" is the gerund form of \"have\", referring to consuming a drink.</p><ul><li>Option (a) 'drink' is the base form of the verb.</li><li>Option (b) 'having to drink' implies an obligation, which is not the meaning here.</li><li>Option (d) 'to drink' is an infinitive.</li><li>Option (c) 'having' is the gerund that correctly follows \"Would you mind\".</li></ul><p>Therefore, the correct answer is (c).</p>",
        },
        {
          id: 5,
          question: "I remembered _ the race.",
          options: {
            a: "the horse's winning to",
            b: "the horse to win",
            c: "the horse winning",
            d: "the horse's to win",
          },
          correct: "c",
          explanation:
            '<p>The verb "remember" can be followed by a gerund (-ing form) or an infinitive (to + verb). When "remember" is followed by a gerund, it means recalling an event or action that has already happened. When followed by an infinitive, it means remembering to do something in the future.</p><ul><li>In this sentence, the speaker is recalling the past event of the horse winning the race. Therefore, a gerund is appropriate.</li><li>To express the subject of the gerund, a possessive form (e.g., "horse\'s") or an object pronoun/noun (e.g., "horse") can be used. Both "the horse\'s winning" and "the horse winning" are grammatically acceptable, though "the horse winning" is more common in modern English when the subject is a noun.</li><li>Option (c) "the horse winning" correctly uses the gerund to refer to the past action and names the doer of the action.</li><li>Option (a) and (d) are grammatically incorrect constructions.</li><li>Option (b) "the horse to win" would imply remembering a future action, which doesn\'t fit the context of recalling a past event.</li></ul><p>Therefore, the correct answer is (c).</p>',
        },
        {
          id: 6,
          question:
            "It is high time we _ the people conscious about our national interest.",
          options: {
            a: "should make",
            b: "made",
            c: "must make",
            d: "will make",
          },
          correct: "b",
          explanation:
            "<p>The phrase \"It is high time\" is followed by the Past Simple Tense, even though it refers to an action that should be done now or in the near future. This structure emphasizes urgency.</p><ul><li>Option (a) 'should make' uses a modal verb.</li><li>Option (c) 'must make' uses a modal verb.</li><li>Option (d) 'will make' uses the future tense.</li><li>Option (b) 'made' is the Past Simple Tense of \"make\", which correctly follows the rule for \"It is high time\".</li></ul><p>Therefore, the correct answer is (b).</p>",
        },
        {
          id: 7,
          question: "She tried to be serious but she couldn't help _.",
          options: {
            a: "laughing",
            b: "laugh",
            c: "to laugh",
            d: "that to laugh",
          },
          correct: "a",
          explanation:
            "<p>The phrase \"cannot help\" (or \"couldn't help\" in the past tense) means \"cannot avoid\" or \"cannot stop oneself from\". It is always followed by a gerund (the -ing form of a verb).</p><ul><li>Option (b) 'laugh' is the base form of the verb.</li><li>Option (c) 'to laugh' is an infinitive.</li><li>Option (d) 'that to laugh' is grammatically incorrect.</li><li>Option (a) 'laughing' is the gerund form, which correctly completes the idiom.</li></ul><p>Therefore, the correct answer is (a).</p>",
        },
        {
          id: 8,
          question: "I want _ more careful with your homework in future.",
          options: {
            a: "you be",
            b: "you to be",
            c: "that you are",
            d: "you will be",
          },
          correct: "b",
          explanation:
            "<p>The verb \"want\" is typically followed by an object and then an infinitive (to + verb) to express a desire for someone else to do something.</p><ul><li>Option (a) 'you be' is grammatically incorrect.</li><li>Option (c) 'that you are' uses a subordinate clause, but \"want\" usually takes the object + infinitive structure in this context.</li><li>Option (d) 'you will be' uses the future tense, but the infinitive is required here.</li><li>Option (b) 'you to be' correctly uses the object (\"you\") followed by the infinitive (\"to be\").</li></ul><p>Therefore, the correct answer is (b).</p>",
        },
        {
          id: 9,
          question: "It is high time we _ our efforts to change the country.",
          options: {
            a: "will use",
            b: "had used",
            c: "used",
            d: "use",
          },
          correct: "c",
          explanation:
            "<p>The phrase \"It is high time\" is followed by the Past Simple Tense, even though it refers to an action that should be done now or in the near future. This structure emphasizes urgency.</p><ul><li>Option (a) 'will use' is in the future tense.</li><li>Option (b) 'had used' is in the Past Perfect Tense.</li><li>Option (d) 'use' is in the present tense.</li><li>Option (c) 'used' is the Past Simple Tense of \"use\", which correctly follows the rule for \"It is high time\".</li></ul><p>Therefore, the correct answer is (c).</p>",
        },
        {
          id: 10,
          question: "We look forward to _ from you.",
          options: {
            a: "hear",
            b: "heard",
            c: "be heard",
            d: "hearing",
          },
          correct: "d",
          explanation:
            "<p>The phrasal verb \"look forward to\" is always followed by a gerund (the -ing form of a verb) or a noun. In this case, we need the gerund form of the verb \"hear\".</p><ul><li>Option (a) 'hear' is the base form of the verb.</li><li>Option (b) 'heard' is the past participle.</li><li>Option (c) 'be heard' is in the passive voice.</li><li>Option (d) 'hearing' is the gerund form, which correctly follows \"look forward to\".</li></ul><p>Therefore, the correct answer is (d).</p>",
        },
        {
          id: 11,
          question:
            "They could not help _ leave the car on the road, where it had broken down.",
          options: {
            a: "unless",
            b: "but",
            c: "than",
            d: "instead of",
          },
          correct: "b",
          explanation:
            '<p>The phrase "could not help but" is an idiom meaning "had no choice but to" or "could not avoid". It is followed by the base form of the verb.</p><ul><li>Option (a) \'unless\' is a conjunction meaning "if not".</li><li>Option (c) \'than\' is a conjunction used for comparison.</li><li>Option (d) \'instead of\' is a prepositional phrase meaning "in place of".</li><li>Option (b) \'but\' is used in the idiom "could not help but".</li></ul><p>Therefore, the correct answer is (b).</p>',
        },
        {
          id: 12,
          question: "Would you mind _?",
          options: {
            a: "looking into the matter",
            b: "to look into the matter",
            c: "looking at the matter",
            d: "looking for the matter",
          },
          correct: "a",
          explanation:
            '<p>The phrase "Would you mind" is followed by a gerund (the -ing form of a verb). Additionally, the appropriate phrasal verb to mean "investigate" or "examine" is "look into".</p><ul><li>Option (b) \'to look into the matter\' uses an infinitive, which is incorrect after "mind".</li><li>Option (c) \'looking at the matter\' means to simply observe, not necessarily investigate.</li><li>Option (d) \'looking for the matter\' means searching for it, which doesn\'t fit the context of a problem.</li><li>Option (a) \'looking into the matter\' correctly uses the gerund and the appropriate phrasal verb for investigation.</li></ul><p>Therefore, the correct answer is (a).</p>',
        },
        {
          id: 13,
          question: "Gradually all of us _ the Internet.",
          options: {
            a: "are getting accustomed to use",
            b: "are becoming accustomed to use",
            c: "are getting accustomed to using",
            d: "are getting used to use",
          },
          correct: "c",
          explanation:
            '<p>The phrase "be accustomed to" or "get accustomed to" is followed by a gerund (the -ing form of a verb) or a noun. It means becoming familiar with something or getting used to it.</p><ul><li>Option (a) \'are getting accustomed to use\' uses the base form of the verb "use", which is incorrect.</li><li>Option (b) \'are becoming accustomed to use\' also uses the base form of the verb "use", which is incorrect.</li><li>Option (d) \'are getting used to use\' incorrectly uses the base form of the verb "use" after "used to". While "get used to" is also followed by a gerund, the form provided is wrong.</li><li>Option (c) \'are getting accustomed to using\' correctly uses the gerund "using" after "accustomed to".</li></ul><p>Therefore, the correct answer is (c).</p>',
        },
        {
          id: 14,
          question: "Something _ very good.",
          options: {
            a: "smells",
            b: "smell",
            c: "smelled",
            d: "seemed",
          },
          correct: "a",
          explanation:
            '<p>The verb "smell" is a linking verb that describes a quality of the subject, similar to "taste," "feel," "look," etc. When the subject is singular (like "Something"), the verb in the present simple tense should take an "-s" ending.</p><ul><li>Option (b) \'smell\' is the base form and is used for plural subjects or "I/you".</li><li>Option (c) \'smelled\' is the past tense. While grammatically correct, it implies a past event, whereas the sentence structure suggests a current observation.</li><li>Option (d) \'seemed\' is the past tense of "seem", which is a different linking verb and changes the meaning.</li><li>Option (a) \'smells\' is the correct present simple form for a singular subject.</li></ul><p>Therefore, the correct answer is (a).</p>',
        },
        {
          id: 15,
          question:
            "Zannat visited the library with a view to _ a rare document.",
          options: {
            a: "find",
            b: "found",
            c: "finding",
            d: "none of them",
          },
          correct: "c",
          explanation:
            "<p>The phrase \"with a view to\" is a prepositional phrase that means \"with the intention of\" or \"for the purpose of\". It is always followed by a gerund (the -ing form of a verb) or a noun.</p><ul><li>Option (a) 'find' is the base form of the verb.</li><li>Option (b) 'found' is the past tense or past participle.</li><li>Option (c) 'finding' is the gerund form, which correctly follows \"with a view to\".</li><li>Option (d) 'none of them' is incorrect.</li></ul><p>Therefore, the correct answer is (c).</p>",
        },
        {
          id: 16,
          question: "Would you mind _ with me?",
          options: {
            a: "to go",
            b: "gone",
            c: "go",
            d: "going",
          },
          correct: "d",
          explanation:
            "<p>The phrase \"Would you mind\" is always followed by a gerund (the -ing form of a verb) when making a polite request or asking for permission.</p><ul><li>Option (a) 'to go' is an infinitive.</li><li>Option (b) 'gone' is the past participle.</li><li>Option (c) 'go' is the base form of the verb.</li><li>Option (d) 'going' is the gerund form, which correctly follows \"Would you mind\".</li></ul><p>Therefore, the correct answer is (d).</p>",
        },
        {
          id: 17,
          question: "She looks forward to _ her appointment letter.",
          options: {
            a: "receive",
            b: "receiving",
            c: "received",
            d: "is receiving",
          },
          correct: "b",
          explanation:
            "<p>The phrasal verb \"look forward to\" is always followed by a gerund (the -ing form of a verb) or a noun. In this case, we need the gerund form of the verb \"receive\".</p><ul><li>Option (a) 'receive' is the base form of the verb.</li><li>Option (c) 'received' is the past tense or past participle.</li><li>Option (d) 'is receiving' is in the present continuous tense.</li><li>Option (b) 'receiving' is the gerund form, which correctly follows \"look forward to\".</li></ul><p>Therefore, the correct answer is (b).</p>",
        },
        {
          id: 18,
          question: "Stella tried to be serious but she couldn't help _.",
          options: {
            a: "to laugh",
            b: "laugh",
            c: "laughing",
            d: "that to laugh",
          },
          correct: "c",
          explanation:
            "<p>The phrase \"cannot help\" (or \"couldn't help\" in the past tense) means \"cannot avoid\" or \"cannot stop oneself from\". It is always followed by a gerund (the -ing form of a verb).</p><ul><li>Option (a) 'to laugh' is an infinitive.</li><li>Option (b) 'laugh' is the base form of the verb.</li><li>Option (d) 'that to laugh' is grammatically incorrect.</li><li>Option (c) 'laughing' is the gerund form, which correctly completes the idiom.</li></ul><p>Therefore, the correct answer is (c).</p>",
        },
        {
          id: 19,
          question: "We wish today _ dead.",
          options: {
            a: "was sunny",
            b: "so that we",
            c: "could spend the day",
            d: "in the village enjoying nature",
          },
          correct: "a",
          explanation:
            '<p>The phrase "We wish" is used to express a desire or regret about a situation that is currently not true or impossible. When expressing a wish about a present situation, the Past Simple Tense (often in the subjunctive mood, using "were" for all subjects) is used for the verb that follows.</p><ul><li>The question seems to have a typo or incomplete options as "dead" makes no sense in this context. Assuming it should be a complete sentence with a common structure like "We wish today <strong>was sunny</strong>" to express a desire for the current weather to be sunny.</li><li>Option (a) \'was sunny\' is in the Past Simple Tense, which is the correct grammatical structure after "We wish" to express a wish about the present. (Note: in more formal or specific subjunctive mood, "were sunny" would also be correct, but "was" is widely accepted in informal contexts).</li><li>Options (b), (c), and (d) are incomplete phrases or change the meaning significantly, focusing on unrelated outcomes rather than the wish itself.</li></ul><p>Given the options, (a) is the most grammatically plausible completion for a wish about a present condition, assuming \'dead\' was a typo or irrelevant ending.</p><p>Therefore, the correct answer is (a).</p>',
        },
        {
          id: 20,
          question: "I am looking forward to _ you soon.",
          options: {
            a: "to seeing",
            b: "seeing",
            c: "to see",
            d: "to have seen",
          },
          correct: "b",
          explanation:
            '<p>The phrasal verb "look forward to" is always followed by a gerund (the -ing form of a verb) or a noun. The "to" in "look forward to" is a preposition, not part of an infinitive.</p><ul><li>Option (a) \'to seeing\' is redundant as the "to" is already part of the phrasal verb.</li><li>Option (c) \'to see\' uses an infinitive, which is incorrect after this phrasal verb.</li><li>Option (d) \'to have seen\' is a perfect infinitive and incorrectly uses "to".</li><li>Option (b) \'seeing\' is the gerund form, which correctly follows "look forward to".</li></ul><p>Therefore, the correct answer is (b).</p>',
        },
        {
          id: 21,
          question: "It is high time we _ the matter.",
          options: {
            a: "will discuss",
            b: "would discuss",
            c: "discussed",
            d: "should discuss",
          },
          correct: "c",
          explanation:
            "<p>The phrase \"It is high time\" is followed by the Past Simple Tense, even though it refers to an action that should be done now or in the near future. This structure emphasizes urgency.</p><ul><li>Option (a) 'will discuss' is in the future tense.</li><li>Option (b) 'would discuss' is part of a conditional structure.</li><li>Option (d) 'should discuss' uses a modal verb.</li><li>Option (c) 'discussed' is the Past Simple Tense of \"discuss\", which correctly follows the rule for \"It is high time\".</li></ul><p>Therefore, the correct answer is (c).</p>",
        },
        {
          id: 22,
          question: "When I was young I used to _ stamps.",
          options: {
            a: "collecting",
            b: "collect",
            c: "collected",
            d: "collects",
          },
          correct: "b",
          explanation:
            "<p>The phrase \"used to\" is followed by the base form of the verb (infinitive without \"to\"). It describes a past habit or a state that is no longer true.</p><ul><li>Option (a) 'collecting' is a gerund.</li><li>Option (c) 'collected' is the past tense or past participle.</li><li>Option (d) 'collects' is the third person singular present tense.</li><li>Option (b) 'collect' is the base form of the verb, which correctly follows \"used to\".</li></ul><p>Therefore, the correct answer is (b).</p>",
        },
        {
          id: 23,
          question: "Most Bangladeshis _ fish every day.",
          options: {
            a: "used to eating",
            b: "are used to eat",
            c: "are used to eating",
            d: "use to eat",
          },
          correct: "c",
          explanation:
            '<p>The phrase "be used to" (or "get used to") is followed by a gerund (the -ing form of a verb) or a noun. It means being accustomed to something or familiar with it.</p><ul><li>Option (a) \'used to eating\' implies a past habit that is no longer true, which doesn\'t fit "every day".</li><li>Option (b) \'are used to eat\' incorrectly uses the base form of the verb after "used to".</li><li>Option (d) \'use to eat\' implies a past habit that no longer exists, and also incorrectly uses "use to" for a present habit.</li><li>Option (c) \'are used to eating\' correctly uses "are used to" (present tense of "be used to") followed by the gerund "eating", indicating a current habit or familiarity.</li></ul><p>Therefore, the correct answer is (c).</p>',
        },
        {
          id: 24,
          question:
            "Choose the correct verb form - Don't go outside until it _ raining.",
          options: {
            a: "stop",
            b: "stops",
            c: "stoping",
            d: "stopted",
          },
          correct: "b",
          explanation:
            "<p>When \"until\" is used in a clause referring to a future event, the verb in the \"until\" clause is typically in the Present Simple Tense, even though it refers to a future action. The subject \"it\" is third person singular, so the verb needs an \"-s\" ending.</p><ul><li>Option (a) 'stop' is the base form, used for plural subjects.</li><li>Option (c) 'stoping' is a misspelling and incorrect form.</li><li>Option (d) 'stopted' is a misspelling and incorrect past tense form.</li><li>Option (b) 'stops' is the correct Present Simple form for a singular subject.</li></ul><p>Therefore, the correct answer is (b).</p>",
        },
        {
          id: 25,
          question:
            "Choose the right form of verb: It is high time we _ on the matter.",
          options: {
            a: "are acting",
            b: "acted",
            c: "have acted",
            d: "could act",
          },
          correct: "b",
          explanation:
            "<p>The phrase \"It is high time\" is followed by the Past Simple Tense, even though it refers to an action that should be done now or in the near future. This structure emphasizes urgency.</p><ul><li>Option (a) 'are acting' is in the present continuous tense.</li><li>Option (c) 'have acted' is in the present perfect tense.</li><li>Option (d) 'could act' uses a modal verb.</li><li>Option (b) 'acted' is the Past Simple Tense of \"act\", which correctly follows the rule for \"It is high time\".</li></ul><p>Therefore, the correct answer is (b).</p>",
        },
        {
          id: 26,
          question:
            "Fill in the gap with the right tense: When water _ it turns into ice.",
          options: {
            a: "will freeze",
            b: "freezes",
            c: "would freeze",
            d: "froze",
          },
          correct: "b",
          explanation:
            "<p>This is an example of a Zero Conditional sentence, which is used to describe general truths, scientific facts, or habits. The structure of a Zero Conditional sentence is: If/When + Present Simple, Present Simple.</p><ul><li>The second part of the sentence \"it turns into ice\" is in the Present Simple Tense.</li><li>Therefore, the first part, the \"when\" clause, must also be in the Present Simple Tense. The subject \"water\" is singular, so the verb needs an \"-es\" ending.</li><li>Option (a) 'will freeze' is in the future tense.</li><li>Option (c) 'would freeze' is part of a conditional structure.</li><li>Option (d) 'froze' is in the past tense.</li><li>Option (b) 'freezes' is the correct Present Simple form for a singular subject.</li></ul><p>Therefore, the correct answer is (b).</p>",
        },
        {
          id: 27,
          question:
            "I don't mind _ with the cooking but I am not going to wash the dishes.",
          options: {
            a: "to help",
            b: "help",
            c: "helping",
            d: "for helping",
          },
          correct: "c",
          explanation:
            "<p>The verb \"mind\" is typically followed by a gerund (the -ing form of a verb). This structure indicates a willingness or unwillingness to do something.</p><ul><li>Option (a) 'to help' is an infinitive.</li><li>Option (b) 'help' is the base form of the verb.</li><li>Option (d) 'for helping' is incorrect as \"mind\" does not take the preposition \"for\" before the gerund in this context.</li><li>Option (c) 'helping' is the gerund form, which correctly follows \"mind\".</li></ul><p>Therefore, the correct answer is (c).</p>",
        },
        {
          id: 28,
          question: "It's time _ your mistakes.",
          options: {
            a: "you realized",
            b: "that you realize",
            c: "you would realize",
            d: "you have realize",
          },
          correct: "a",
          explanation:
            "<p>The phrase \"It's time\" (or \"It's high time\") is followed by the Past Simple Tense when referring to an action that should be done now or in the near future. This structure expresses urgency or a strong suggestion.</p><ul><li>Option (b) 'that you realize' uses the present tense, which is incorrect in this structure.</li><li>Option (c) 'you would realize' uses a modal verb.</li><li>Option (d) 'you have realize' is grammatically incorrect (\"have realized\" would be present perfect, but still not fitting this construction).</li><li>Option (a) 'you realized' uses the Past Simple Tense, which correctly follows the rule for \"It's time\".</li></ul><p>Therefore, the correct answer is (a).</p>",
        },
      ];

      const totalQuestions = questions.length;
      let timeLeft = Math.floor(totalQuestions / 2) * 60;
      const timerElement = document.getElementById("timer");
      let timerInterval;

      function updateTimer() {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        timerElement.innerText = `${toBengaliNumber(
          minutes
        )} মিনিট ${toBengaliNumber(seconds)} সেকেন্ড`;

        if (timeLeft > 0) {
          timeLeft--;
        } else {
          stopTimer();
          confirmSubmit();
        }
      }

      function startTimer() {
        console.log("Starting timer");
        timerElement.innerText = `${toBengaliNumber(
          Math.floor(timeLeft / 60)
        )} মিনিট ${toBengaliNumber(timeLeft % 60)} সেকেন্ড`;
        timerInterval = setInterval(updateTimer, 1000);
      }

      function stopTimer() {
        clearInterval(timerInterval);
        console.log("Timer stopped");
      }

      function toBengaliNumber(num) {
        const bengaliDigits = [
          "০",
          "১",
          "২",
          "৩",
          "৪",
          "৫",
          "৬",
          "৭",
          "৮",
          "৯",
        ];
        let numStr = num.toString();

        let isNegative = num < 0;
        if (isNegative) {
          numStr = numStr.substring(1);
        }

        if (numStr.includes(".")) {
          let [integerPart, decimalPart] = numStr.split(".");
          let integerBengali = integerPart
            .split("")
            .map((digit) => bengaliDigits[parseInt(digit)])
            .join("");
          let decimalBengali = decimalPart
            .split("")
            .map((digit) => bengaliDigits[parseInt(digit)])
            .join("");
          return (
            (isNegative ? "−" : "") + integerBengali + "." + decimalBengali
          );
        } else {
          let integerBengali = numStr
            .split("")
            .map((digit) => bengaliDigits[parseInt(digit)])
            .join("");
          return (isNegative ? "−" : "") + integerBengali;
        }
      }

      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      function generateQuestions() {
        console.log("Generating questions");
        const examContainer = document.querySelector("#exam");
        if (!examContainer) {
          console.error("Exam container (#exam) not found!");
          return;
        }
        examContainer.innerHTML = "";
        console.log("Questions array:", questions);
        const shuffledQuestions = shuffleArray([...questions]);
        shuffledQuestions.forEach((question, index) => {
          console.log(`Generating question ${index + 1}:`, question);
          const questionDiv = document.createElement("div");
          questionDiv.classList.add("question-container");
          questionDiv.setAttribute("data-question", question.id);
          questionDiv.setAttribute("data-correct", question.correct);

          let optionsHTML = "";
          for (let option in question.options) {
            optionsHTML += `
                                                                          <label class="option" data-option="${option}">
                                                                            <div class="circle">${option}</div>
                                                                            <span class="option-text">${question.options[option]}</span>
                                                                          </label>
                                                                        `;
          }

          const explanationHTML = question.explanation
            ? `<div class="explanation-dropdown">
                                                                             <button class="explanation-btn">ব্যাখ্যা দেখো</button>
                                                                             <div class="explanation-content">
                                                                               <div class="explanation-label">ব্যাখ্যা:</div>
                                                                               ${question.explanation}
                                                                             </div>
                                                                           </div>`
            : "";

          questionDiv.innerHTML = `
                                                                        <p class="question-label">${
                                                                          index +
                                                                          1
                                                                        }. ${
            question.question
          }</p>
                                                                        <div class="options">
                                                                          ${optionsHTML}
                                                                        </div>
                                                                        ${explanationHTML}
                                                                      `;
          examContainer.appendChild(questionDiv);
          console.log(`Appended question ${index + 1} to exam container`);
        });

        const questionContainers = document.querySelectorAll(
          ".question-container"
        );
        console.log(`Found ${questionContainers.length} question containers`);
        questionContainers.forEach((container, idx) => {
          console.log(`Setting question ${idx + 1} to visible`);
          container.style.display = "block";
        });

        document.querySelectorAll(".option").forEach((option) => {
          option.addEventListener(
            "click",
            function (e) {
              e.preventDefault();
              const parent = this.closest(".question-container");
              if (parent.classList.contains("locked")) return;
              parent.classList.add("locked");
              parent.querySelectorAll(".option").forEach((el) => {
                if (el !== this) {
                  el.style.pointerEvents = "none";
                  el.style.cursor = "default";
                }
                el.classList.remove("selected");
              });
              this.classList.add("selected");
              console.log(
                `Option selected for question ${parent.getAttribute(
                  "data-question"
                )}: ${this.getAttribute("data-option")}`
              );
            },
            { once: true }
          );
        });

        document.querySelectorAll(".explanation-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            const content = this.nextElementSibling;
            content.classList.toggle("visible");
            this.classList.toggle("active");
            console.log("Toggled explanation visibility");
          });
        });

        const examInfo = document.getElementById("exam-info");
        if (examInfo) {
          examInfo.innerText = `পূর্ণ নম্বরঃ ${toBengaliNumber(
            totalQuestions
          )}`;
          console.log("Exam info updated");
        } else {
          console.error("Exam info element not found!");
        }
      }

      function initializeChart() {
        console.log("Initializing chart");
        const ctx = document.getElementById("scoreChart").getContext("2d");
        chartInstance = new Chart(ctx, {
          type: "pie",
          data: {
            labels: ["ঠিক উত্তর", "ভুল উত্তর", "অনুত্তরিত"],
            datasets: [
              {
                data: [0, 0, 0],
                backgroundColor: ["#34c759", "#ff3b30", "#007aff"],
                borderColor: "#fff",
                borderWidth: 2,
                hoverOffset: 10,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: "10%",
            layout: {
              padding: 10,
            },
            plugins: {
              legend: {
                position: "bottom",
                labels: {
                  font: {
                    family: '"Hind Siliguri", sans-serif',
                    size: 13,
                    weight: "bold",
                  },
                  color: "#333",
                  padding: 12,
                  boxWidth: 14,
                  generateLabels: (chart) => {
                    const data = chart.data;
                    return data.labels.map((label, i) => ({
                      text: label,
                      font: {
                        family: '"Hind Siliguri", sans-serif',
                      },
                      fillStyle: data.datasets[0].backgroundColor[i],
                      hidden: !chart.getDataVisibility(i),
                      index: i,
                    }));
                  },
                },
              },
              tooltip: {
                backgroundColor: "rgba(0, 0, 0, 0.9)",
                cornerRadius: 6,
                titleFont: {
                  family: '"Hind Siliguri", sans-serif',
                  size: 14,
                  weight: "bold",
                },
                bodyFont: {
                  family: '"Hind Siliguri", sans-serif',
                  size: 13,
                },
                padding: 10,
                boxPadding: 5,
              },
            },
            animation: {
              animateScale: true,
              animateRotate: true,
              duration: 1000,
              easing: "easeOutQuart",
            },
            elements: {
              arc: {
                borderRadius: 8,
              },
            },
            onClick: (e, elements) => {
              if (elements.length > 0) {
                const index = elements[0].index;
                const filter = ["correct", "wrong", "unanswered"][index];
                filterQuestions(filter);
              } else {
                filterQuestions("all");
              }
            },
          },
        });
        console.log("Chart initialized");
      }

      function filterQuestions(type) {
        console.log(`Filtering questions by type: ${type}`);
        document.querySelectorAll(".question-container").forEach((question) => {
          const status = question.getAttribute("data-status");
          if (type === "all" || status === type) {
            question.style.display = "block";
          } else {
            question.style.display = "none";
          }
        });
      }

      function showConfirmPopup() {
        console.log("Showing confirm popup");
        document.getElementById("confirmPopup").style.display = "block";
      }

      function autoSubmitScore() {
        console.log("Auto-submitting score");
        stopTimer();
        let score = 0,
          total = questions.length,
          answered = 0,
          correct = 0,
          wrong = 0,
          unanswered = 0;

        document.querySelectorAll(".question-container").forEach((question) => {
          let correctAnswer = question.getAttribute("data-correct");
          let selectedOption = question.querySelector(".option.selected");

          if (selectedOption) {
            answered++;
            let chosenAnswer = selectedOption.getAttribute("data-option");
            if (chosenAnswer === correctAnswer) {
              score += 1;
              correct++;
              question.setAttribute("data-status", "correct");
            } else {
              score -= 0.25;
              wrong++;
              question.setAttribute("data-status", "wrong");
            }
          } else {
            unanswered++;
            question.setAttribute("data-status", "unanswered");
          }
        });

        const userID = sessionStorage.getItem("userID") || "anonymous";
        const formData = new FormData();
        formData.append("userID", userID);
        formData.append("finalScore", score.toFixed(2));
        formData.append("correctAnswers", correct);
        formData.append("wrongAnswers", wrong);
        formData.append("unanswered", unanswered);

        const url = "https://formspree.io/f/xpwy";
        navigator.sendBeacon(url, formData);
        console.log("Auto-submission sent via sendBeacon for userID:", userID);
      }

      function confirmSubmit() {
        console.log("Confirming submission");
        document.getElementById("confirmPopup").style.display = "none";
        stopTimer();
        let score = 0,
          total = questions.length,
          answered = 0,
          correct = 0,
          wrong = 0,
          unanswered = 0;

        document
          .querySelectorAll(".question-container")
          .forEach((question, index) => {
            let correctAnswer = question.getAttribute("data-correct");
            let selectedOption = question.querySelector(".option.selected");

            if (selectedOption) {
              answered++;
              let chosenAnswer = selectedOption.getAttribute("data-option");
              if (chosenAnswer === correctAnswer) {
                selectedOption
                  .querySelector(".option-text")
                  .classList.add("correct-text");
                score += 1;
                correct++;
                question.setAttribute("data-status", "correct");
              } else {
                selectedOption
                  .querySelector(".option-text")
                  .classList.add("incorrect-text");
                question
                  .querySelector(
                    `[data-option="${correctAnswer}"] .option-text`
                  )
                  .classList.add("correct-text");
                score -= 0.25;
                wrong++;
                question.setAttribute("data-status", "wrong");
              }
            } else {
              question
                .querySelector(`[data-option="${correctAnswer}"] .option-text`)
                .classList.add("unattempted-text");
              unanswered++;
              question.setAttribute("data-status", "unanswered");
            }
            question.style.display = "block";

            const explanationDropdown = question.querySelector(
              ".explanation-dropdown"
            );
            if (explanationDropdown) {
              explanationDropdown.classList.add("visible");
            }
          });

        const chartContainer = document.querySelector(".chart-container");
        chartContainer.classList.add("visible");
        if (!chartInstance) {
          initializeChart();
        }
        chartInstance.data.datasets[0].data = [correct, wrong, unanswered];
        chartInstance.update();
        console.log("Chart updated with data:", [correct, wrong, unanswered]);

        const userID = sessionStorage.getItem("userID") || "anonymous";
        document.getElementById("totalQuestions").innerText =
          toBengaliNumber(total);
        document.getElementById("answered").innerText =
          toBengaliNumber(answered);
        document.getElementById("correctAnswers").innerText =
          toBengaliNumber(correct);
        document.getElementById("wrongAnswers").innerText =
          toBengaliNumber(wrong);
        document.getElementById("unanswered").innerText =
          toBengaliNumber(unanswered);
        document.getElementById("finalScore").innerText = toBengaliNumber(
          score.toFixed(2)
        );

        document.getElementById("formUserID").value = userID;
        document.getElementById("formFinalScore").value = score.toFixed(2);
        document.getElementById("formCorrectAnswers").value = correct;
        document.getElementById("formWrongAnswers").value = wrong;
        document.getElementById("formUnanswered").value = unanswered;

        document.getElementById("submitBtn").style.display = "none";

        document.getElementById("scorePopup").style.display = "block";

        const form = document.getElementById("scoreForm");
        fetch(form.action, {
          method: "POST",
          body: new FormData(form),
          headers: {
            Accept: "application/json",
          },
        })
          .then((response) => {
            if (response.ok) {
              console.log("Form submitted successfully");
              form.reset();
            } else {
              console.error("Form submission failed:", response.statusText);
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }

      function cancelSubmit() {
        console.log("Canceling submission");
        document.getElementById("confirmPopup").style.display = "none";
      }

      document
        .getElementById("submitBtn")
        .addEventListener("click", function () {
          console.log("Submit button clicked");
          showConfirmPopup();
        });

      function closePopup() {
        console.log("Closing score popup");
        const scorePopup = document.getElementById("scorePopup");
        scorePopup.classList.add("slide-out");
        setTimeout(() => {
          scorePopup.style.display = "none";
          scorePopup.classList.remove("slide-out");
          window.scrollTo({ top: 0, behavior: "smooth" });
        }, 500);
      }

      document
        .getElementById("scoreForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          console.log("Score form submitted");
          closePopup();
        });
    </script>
  </body>
</html>
